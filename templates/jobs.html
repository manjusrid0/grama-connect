{% extends "base.html" %}
{% block content %}

<!--
  jobs.html
  - Post a job (form)
  - Job listings (cards)
  - Apply button (posts to your apply route)
  - View Applicants button shown only to job poster
  Notes: This template intentionally avoids inner overflow so the page scrollbar appears on the right.
-->

<style>
/* Page basics & full-page scroll setup */
html, body { height: 100%; margin: 0; padding: 0; font-family: "Poppins", sans-serif; }
body {
  background: linear-gradient(135deg,#dff7cc,#9fd66a 60%, #56ab2f);
  color: #07300a;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  /* Let the browser show the vertical scrollbar on the right (default) */
  overflow-y: auto;
  padding: 28px;
  box-sizing: border-box;
}

/* Global scrollbar styling (works in WebKit & Firefox) */
* { scrollbar-width: thin; scrollbar-color: rgba(0,0,0,0.28) rgba(255,255,255,0.12); }
::-webkit-scrollbar { width: 12px; height: 12px; }
::-webkit-scrollbar-track { background: rgba(255,255,255,0.08); border-radius: 8px; }
::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.22); border-radius: 8px; border: 2px solid rgba(255,255,255,0.06); }

/* Main container */
.container {
  max-width: 1100px;
  margin: 0 auto;
  display: block;
  gap: 24px;
}

/* Post job card (top) */
.post-card {
  background: rgba(255,255,255,0.10);
  backdrop-filter: blur(6px);
  border-radius: 14px;
  padding: 18px;
  box-shadow: 0 8px 18px rgba(0,0,0,0.12);
  margin-bottom: 22px;
}

.post-card h2 {
  margin: 0 0 12px 0;
  color: #072e0a;
  font-size: 20px;
}

/* Inputs */
.post-card form .row { display: flex; gap: 12px; margin-bottom: 10px; }
.post-card input[type="text"],
.post-card textarea,
.post-card select {
  flex: 1;
  padding: 10px 12px;
  background: rgba(255,255,255,0.95);
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,0.06);
  font-size: 14px;
  box-sizing: border-box;
}
.post-card textarea { min-height: 84px; resize:vertical; }

/* Post button */
.post-btn {
  display:inline-block;
  background: linear-gradient(180deg,#43c905,#2e8b57);
  color: #fff;
  padding: 10px 16px;
  border-radius: 10px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  transition: transform .12s ease, box-shadow .12s ease;
}
.post-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,0.12); }

/* Jobs list: vertical flow, but cards are horizontal rows */
.jobs-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* Job card: left logo, middle details, right actions */
.job-card {
  display: flex;
  gap: 16px;
  align-items: center;
  background: #ffffff;
  border-radius: 12px;
  padding: 14px;
  box-shadow: 0 8px 18px rgba(0,0,0,0.08);
}

/* left small logo */
.job-logo {
  width: 86px;
  height: 86px;
  border-radius: 10px;
  background: linear-gradient(135deg,#2f7f2f,#66cc66);
  color: #fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:18px;
  flex-shrink:0;
}

/* middle details area */
.job-body {
  flex: 1;
  min-width: 0; /* allow text truncation */
}

.job-title {
  font-size:16px;
  color:#11441b;
  margin:0 0 6px 0;
  font-weight:700;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.job-desc {
  font-size:13px;
  color:#2d5d36;
  margin:0 0 8px 0;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

/* metadata row */
.meta-row { display:flex; gap:14px; align-items:center; font-size:13px; color:#2f5b3a; flex-wrap:wrap; }
.meta-item { display:flex; gap:6px; align-items:center; }

/* right action column */
.job-actions {
  display:flex;
  flex-direction:column;
  gap:8px;
  align-items:stretch;
  width:180px;
  flex-shrink:0;
}

/* primary action (apply) */
.apply-btn {
  background: linear-gradient(180deg,#43c905,#2e8b57);
  color:#fff;
  border:none;
  padding:10px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  transition: transform .12s ease;
  width:100%;
}
.apply-btn:hover { transform: translateY(-2px); }

/* secondary (view applicants) */
.view-btn {
  background: transparent;
  color:#11441b;
  border: 2px solid rgba(17,68,27,0.12);
  padding:8px;
  border-radius:10px;
  font-weight:700;
  text-align:center;
  text-decoration:none;
  display:inline-block;
}

/* small responsive tweaks */
@media (max-width: 860px) {
  .job-card { flex-direction: column; align-items: stretch; }
  .job-logo { width:100%; height:90px; border-radius:10px; }
  .job-actions { width:100%; flex-direction:row; gap:10px; }
}
</style>

<div class="container">

  <!-- Post job form -->
  <div class="post-card" role="region" aria-labelledby="post-job-heading">
    <h2 id="post-job-heading">Post a Job</h2>
    <form method="POST" action="{{ url_for('view_jobs') }}">
      <div class="row">
        <input type="text" name="title" placeholder="Job title" required>
        <input type="text" name="job_type" placeholder="Job type (Full/Part time)">
      </div>
      <div class="row">
        <input type="text" name="location" placeholder="Location" required>
        <input type="text" name="salary" placeholder="Salary">
      </div>
      <div class="row">
        <input type="text" name="contact" placeholder="Contact info" required>
      </div>
      <div>
        <textarea name="description" placeholder="Job description (what's required / responsibilities)" required></textarea>
      </div>

      <div style="margin-top:10px; display:flex; gap:12px;">
        <button type="submit" class="post-btn">Post Job</button>
        <a href="{{ url_for('dashboard') }}" class="view-btn" style="align-self:center; padding:10px 12px; border-radius:10px;">Back to Dashboard</a>
      </div>
    </form>
  </div>

  <!-- Job listings -->
  {% if jobs %}
  <div class="jobs-list" aria-live="polite">
    {% for job in jobs %}
    <div class="job-card" role="article" aria-label="Job: {{ job.title }}">
      <div class="job-logo" title="{{ job.title }}">
        {{ job.title[:2] | upper }}
      </div>

      <div class="job-body">
        <div class="job-title">{{ job.title }}</div>
        <div class="job-desc">{{ job.description }}</div>

        <div class="meta-row" aria-hidden="false">
          <div class="meta-item"><strong>Location:</strong>&nbsp;<span>{{ job.location }}</span></div>
          <div class="meta-item"><strong>Salary:</strong>&nbsp;<span>{{ job.salary or '—' }}</span></div>
          <div class="meta-item"><strong>Type:</strong>&nbsp;<span>{{ job.job_type or '—' }}</span></div>
        </div>
      </div>

      <div class="job-actions">
        <!-- Apply button (posts to /jobs) -->
        <form method="POST" action="{{ url_for('user_view_jobs') }}" style="margin:0;">
          <input type="hidden" name="job_id" value="{{ job.id }}">
          <input type="hidden" name="name" value="{{ current_user.name }}">
          <input type="hidden" name="email" value="{{ current_user.email }}">
          <input type="hidden" name="phone" value="{{ current_user.phone }}">
          <button type="submit" class="apply-btn">Apply</button>
        </form>

        <!-- View applicants only visible to job poster -->
        {% if current_user.is_authenticated and current_user.id == job.user_id %}
          <a class="view-btn" href="{{ url_for('view_applicants', job_id=job.id) }}">View Applicants</a>
        {% else %}
          <a class="view-btn" href="{{ url_for('view_applicants', job_id=job.id) }}" style="opacity:0.95;">Poster only</a>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <p style="text-align:center; color:#0b3f17; font-weight:700; margin-top:40px;">No jobs posted yet.</p>
  {% endif %}

</div>

<!-- Small guard to avoid accidental double submit -->
<script>
document.addEventListener('submit', function(e){
  const btn = e.target.querySelector('button[type="submit"]');
  if (btn) {
    btn.disabled = true;
    setTimeout(()=>btn.disabled=false, 1200);
  }
});
</script>

{% endblock %}
