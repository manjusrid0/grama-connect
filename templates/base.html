<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="UTF-8">
  <title>{{ _("Grama Connect") }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>
    body {
      margin: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 1s ease-in-out;
      height: 100vh;
      overflow: hidden;
    }

    header {
      position: relative;
      z-index: 10;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 20px 0;
      text-align: center;
    }

    .header-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      font-size: 18px;
      margin: 0 10px;
    }

    nav a:hover {
      text-decoration: underline;
    }

    h1 {
      color: white;
      margin: 0;
      font-size: 32px;
    }

    .center-marquee {
      position: absolute;
      bottom: -100px;
      width: 100%;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 5px #3e99d6;
      animation: scrollUp 10s linear infinite;
      z-index: 5;
    }

    @keyframes scrollUp {
      0%   { bottom: -100px; opacity: 0; }
      20%  { opacity: 1; }
      50%  { bottom: 40%; opacity: 1; }
      80%  { opacity: 1; }
      100% { bottom: 100%; opacity: 0; }
    }

    .hidden-slides {
      display: none;
    }

    .language-selector {
      text-align: right;
      padding: 10px;
    }
  </style>

  <script>
    let selectedLanguage = "{{ get_locale() }}";

    function speak(text) {
      if (!('speechSynthesis' in window)) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = (selectedLanguage === 'ta') ? 'ta-IN' : 'en-US';
      window.speechSynthesis.speak(utterance);
    }

    function greetUser() {
      const greeting = selectedLanguage === 'ta'
        ? "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æï‡Æø‡Æ∞‡Ææ‡ÆÆ‡Ææ ‡Æï‡Æ©‡ØÜ‡Æï‡Øç‡Æü‡Øç ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç"
        : "Welcome to Grama Connect web app. Empowering rural talent.";
      speak(greeting);
    }

    function addVoiceToAllActions() {
      // Buttons and voice-action class
      document.querySelectorAll('button, .voice-action').forEach(elem => {
        elem.addEventListener('click', () => {
          let label = elem.innerText || elem.getAttribute('aria-label') || "Action performed";
          const msg = (selectedLanguage === 'ta')
            ? "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§ ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æø: " + label
            : "You selected: " + label;
          speak(msg);
        });
      });

      // Input fields
      document.querySelectorAll('input, textarea, select').forEach(input => {
        input.addEventListener('focus', () => {
          const label = input.getAttribute('aria-label') || input.name || input.id || 'form field';
          const msg = (selectedLanguage === 'ta')
            ? label + " ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡ØÅ‡Æï"
            : "Please enter: " + label;
          speak(msg);
        });
      });

      // Form submit
      document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', () => {
          const msg = (selectedLanguage === 'ta')
            ? "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ÆÆ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ©"
            : "Your form has been submitted";
          speak(msg);
        });
      });
    }

    window.onload = function () {
      greetUser();
      addVoiceToAllActions();
    };
  </script>
</head>

<body>

  <!-- üåê Language Selector -->
  <div class="language-selector">
    <form>
      <select onchange="location = this.value;">
        {% for code, name in config['LANGUAGES'].items() %}
          <option value="{{ url_for('set_language', language=code) }}"
            {% if code == get_locale() %} selected {% endif %}>
            {{ name }}
          </option>
        {% endfor %}
      </select>
    </form>
  </div>

  <!-- üîä Header -->
  <header>
    <div class="header-container">
      <h1>{{ _("Grama Connect") }}</h1>
      <nav>
        <a href="{{ url_for('home') }}">{{ _("Home") }}</a> |
        <a href="{{ url_for('user_login') }}">{{ _("Login") }}</a> |
        <a href="{{ url_for('register') }}">{{ _("Register") }}</a> |
        <a href="{{ url_for('admin_login') }}">{{ _("Admin") }}</a> |
        <a href="{{ url_for('about') }}">{{ _("About Us") }}</a> |
        <a href="{{ url_for('logout') }}">{{ _("Logout") }}</a>
      </nav>
    </div>
  </header>

  <!-- üì¢ Marquee (optional slogan) -->
  
  <!-- üîÅ Flash Message Reader -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for msg in messages %}
        <div class="alert">{{ msg }}</div>
        <script> speak("{{ msg }}"); </script>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- üì¶ Main Content Block -->
  {% block content %}{% endblock %}

</body>
</html>
