<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
  <meta charset="UTF-8">
  <title>{{ _("Grama Connect") }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body {
      margin: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 1s ease-in-out;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    header {
      position: relative;
      z-index: 10;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 20px 0;
      text-align: center;
    }
    .header-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      font-size: 18px;
      margin: 0 10px;
    }
    nav a:hover {
      text-decoration: underline;
    }
    h1 {
      color: white;
      margin: 0;
      font-size: 32px;
    }
    .center-marquee {
      position: absolute;
      bottom: -100px;
      width: 100%;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: rgb(250, 234, 5);
      text-shadow: 2px 2px 5px #111802;
      animation: scrollUp 10s linear infinite;
      z-index: 5;
    }
    @keyframes scrollUp {
      0%   { bottom: -100px; opacity: 0; }
      20%  { opacity: 1; }
      50%  { bottom: 40%; opacity: 1; }
      80%  { opacity: 1; }
      100% { bottom: 100%; opacity: 0; }
    }
    .hidden-slides {
      display: none;
    }
    .language-selector {
      text-align: right;
      padding: 10px;
    }
    #assistant-box {
      position: fixed;
      bottom: 90px;
      right: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid #26292b;
      border-radius: 10px;
      padding: 10px;
      width: 280px;
      box-shadow: 0 0 10px #0a0202;
      font-size: 15px;
      display: none;
      z-index: 9999;
      max-height: 200px;
      overflow-y: auto;
    }
    #assistant-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #4ed80d;
      color: rgb(224, 245, 133);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 28px;
      z-index: 9999;
      box-shadow: 2px 2px 10px #000;
    }
    label {
            display: block;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
            color: rgba(0, 0, 0, 0.5);  /* üíö label color */
        }
  </style>
</head>
<body onload="greetUser(); addVoiceToAllElements();">

  <!-- üåê Language Selector -->
  <div class="language-selector">
    <form>
      <select onchange="location = this.value;">
        {% for code, name in config['LANGUAGES'].items() %}
          <option value="{{ url_for('set_language', language=code) }}" {% if code == get_locale() %} selected {% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </form>
  </div>

  <!-- üîä Header -->
  <header>
    <div class="header-container">
      <h1>{{ _("Grama Connect") }}</h1>
      <nav>
        <a href="{{ url_for('home') }}">{{ _("Home") }}</a>
        <a href="{{ url_for('user_login') }}">{{ _("Login") }}</a>
        <a href="{{ url_for('register') }}">{{ _("Register") }}</a>
        <a href="{{ url_for('admin_login') }}">{{ _("Admin") }}</a>
        <a href="{{ url_for('about') }}">{{ _("About Us") }}</a>
        <a href="{{ url_for('logout') }}">{{ _("Logout") }}</a>
      </nav>
    </div>
  </header>

  <!-- üì¢ Flash Message Reader -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for msg in messages %}
        <div class="alert">{{ msg }}</div>
        <script> speak("{{ msg }}"); </script>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- üì¶ Main Content Block -->
  {% block content %}{% endblock %}

  <!-- üé§ Smart Assistant Box -->
  <div id="assistant-box"><div id="assistant-log"></div></div>
  <button id="assistant-btn" onclick="toggleAssistant()">üé§</button>

  <script>
    let selectedLanguage = "{{ get_locale() }}";
    let assistantActive = false;

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      const voices = window.speechSynthesis.getVoices();
      if (selectedLanguage === 'ta') {
        utterance.voice = voices.find(v => v.lang.includes('ta'));
        utterance.lang = 'ta-IN';
      } else {
        utterance.voice = voices.find(v => v.lang === 'en-US') || voices[0];
        utterance.lang = 'en-US';
      }
      window.speechSynthesis.speak(utterance);
    }

    function greetUser() {
      const greeting = selectedLanguage === 'ta'
        ? "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æï‡Æø‡Æ∞‡Ææ‡ÆÆ‡Ææ ‡Æï‡Æ©‡ØÜ‡Æï‡Øç‡Æü‡Øç ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Æø‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç"
        : "Welcome to Grama Connect web app. Empowering rural talent.";
      speak(greeting);
    }

    function toggleAssistant() {
      assistantActive = !assistantActive;
      document.getElementById('assistant-box').style.display = assistantActive ? 'block' : 'none';
      if (assistantActive) {
        speak(selectedLanguage === 'ta' ? '‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æé‡Æ©‡Øç‡Æ© ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç?' : 'What would you like to do?');
        startListening();
      } else {
        speak(selectedLanguage === 'ta' ? '‡ÆÖ‡Æ∏‡Æø‡Æ∏‡Øç‡Æü‡Æ©‡Øç‡Æü‡Øç ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ' : 'Assistant turned off');
      }
    }

    function startListening() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = selectedLanguage === 'ta' ? 'ta-IN' : 'en-US';
      recognition.start();
      recognition.onresult = function(event) {
        const command = event.results[0][0].transcript.toLowerCase();
        updateAssistantLog('üë§', command);
        handleCommand(command);
      };
      recognition.onend = function() {
        if (assistantActive) setTimeout(startListening, 1000);
      };
    }

    function updateAssistantLog(who, msg) {
      const box = document.getElementById('assistant-log');
      const div = document.createElement('div');
      div.innerHTML = `<b>${who}</b>: ${msg}`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    function handleCommand(command) {
      let response = '';
      if (command.includes('login') || command.includes('‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà')) {
        response = selectedLanguage === 'ta' ? '‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ ‡Æ™‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ' : 'Going to login page';
        window.location.href = '/login';
      } else if (command.includes('register') || command.includes('‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ')) {
        response = selectedLanguage === 'ta' ? '‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ ‡Æ™‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ' : 'Going to registration page';
        window.location.href = '/register';
      } else {
        response = selectedLanguage === 'ta' ? '‡ÆÆ‡Æ©‡Øç‡Æ©‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æ™‡ØÅ‡Æ∞‡Æø‡ÆØ‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà' : "Sorry, I didn't understand that";
      }
      speak(response);
    }

    function addVoiceToAllElements() {
      document.querySelectorAll('nav a, button, .voice-action').forEach(elem => {
        elem.addEventListener('click', () => {
          const label = elem.innerText || elem.getAttribute('aria-label') || "Action";
          const msg = selectedLanguage === 'ta'
            ? `${label} ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Øà ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç`
            : `You selected: ${label}`;
          speak(msg);
        });
      });

      document.querySelectorAll('input, textarea, select').forEach(input => {
        input.addEventListener('focus', () => {
          const label = input.placeholder || input.getAttribute('aria-label') || input.name || 'field';
          const msg = selectedLanguage === 'ta'
            ? `${label} ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç`
            : `Please enter: ${label}`;
          speak(msg);
        });
      });

      document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', () => {
          const msg = selectedLanguage === 'ta'
            ? "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ÆÆ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ©"
            : "Your form has been submitted";
          speak(msg);
        });
      });
    }

    window.onload = function () {
      speechSynthesis.onvoiceschanged = () => { speechSynthesis.getVoices(); };
      greetUser();
      addVoiceToAllElements();
    }
  </script>

</body>
</html>



